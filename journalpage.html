<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Journal â€“ Write</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
<div class="app-container">

  <h1>Thoughts In My Head</h1>
  <p class="subtitle">Come on! Spill the tea!</p>

  <form id="journalForm" class="form">

    <div class="field-box">
      <label>Date & Time</label>
      <input type="text" id="dateTime" readonly />
    </div>

    <div class="field-box">
      <label>A Space To Write Your Thoughts</label>
      <textarea id="journalText" rows="6" required></textarea>
    </div>

    <div id="reflectiveQuestions"></div>

    <div class="field-box">
      <label>Add Image (optional)</label>
      <input type="file" id="imageUpload" accept="image/*">
      <img id="imagePreview" style="display:none;max-width:100%;margin-top:10px;border-radius:10px;">
    </div>

    <div class="field-box">
      <label>Sticker (optional)</label>
      <div id="stickers">
        <span class="sticker">ğŸŒ¸</span><span class="sticker">ğŸŒ¿</span>
        <span class="sticker">â˜€ï¸</span><span class="sticker">ğŸŒ™</span>
        <span class="sticker">ğŸ’–</span><span class="sticker">ğŸ˜Š</span>
        <span class="sticker">ğŸ˜’</span><span class="sticker">ğŸ™Œ</span>
        <span class="sticker">ğŸ‘</span><span class="sticker">ğŸ˜‰</span>
        <span class="sticker">ğŸ˜»</span>
        <span class="sticker">ğŸ¤</span>
        
      </div>
      <input type="hidden" id="selectedSticker">
    </div>

    <button type="submit" class="btn-primary">Save Entry</button>

  </form>
</div>

<script>
let imageData = "";

document.addEventListener("DOMContentLoaded", () => {

  const journalForm = document.getElementById("journalForm");
  const dateTimeInput = document.getElementById("dateTime");
  const reflectiveContainer = document.getElementById("reflectiveQuestions");

  const now = new Date();
  dateTimeInput.value = now.toLocaleString("en-US", {
    day:"2-digit", month:"long", year:"numeric", hour:"2-digit", minute:"2-digit"
  });

  const reflectiveQs = [
    "How was your day?",
    "What are you grateful for?"
  ];

  reflectiveQs.forEach((q,i)=>{
    reflectiveContainer.innerHTML += `
      <div class="field-box">
        <label>${q}</label>
        <input type="text" id="ref${i}">
      </div>`;
  });

  document.getElementById("imageUpload").addEventListener("change", function(){
    const file = this.files[0];
    if(!file) return;

    if(file.size > 500*1024){
      alert("Image must be under 500KB ğŸŒ¿");
      this.value="";
      return;
    }

    const reader = new FileReader();
    reader.onload = () => {
      imageData = reader.result;
      const img = document.getElementById("imagePreview");
      img.src = imageData;
      img.style.display = "block";
    };
    reader.readAsDataURL(file);
  });

  document.querySelectorAll(".sticker").forEach(s=>{
    s.onclick = ()=>{
      document.getElementById("selectedSticker").value = s.textContent;
      document.querySelectorAll(".sticker").forEach(x=>x.style.background="");
      s.style.background="#dfe3ff";
    };
  });

  journalForm.onsubmit = e => {
    e.preventDefault();

    let entries = JSON.parse(localStorage.getItem("journalEntries")) || [];
    const editIndex = localStorage.getItem("editIndex");

    const reflections = {};
    reflectiveQs.forEach((q,i)=>{
      reflections[q] = document.getElementById(`ref${i}`).value;
    });

    const entryData = {
      date: now.toDateString(),
      time: now.toLocaleTimeString(),
      month: now.toLocaleString("en-US",{month:"long",year:"numeric"}),
      journalText: journalText.value,
      reflectiveAnswers: reflections,
      image: imageData,
      sticker: selectedSticker.value
    };

    if(editIndex !== null){
      entries[editIndex] = entryData;
      localStorage.removeItem("editIndex");
    } else {
      entries.push(entryData);
    }

    localStorage.setItem("journalEntries", JSON.stringify(entries));
    window.location.href = "past.html";
  };
});
</script>
</body>
</html>
